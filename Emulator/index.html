<!DOCTYPE html>
<html>

<head>
    <title>Emulator</title>
    <link rel="stylesheet" href="./JS/style.css">
</head>

<body>
    <div id="container">
        <select id="Packs" class="dropdown">
            <option style="text-align: center;">Select a game:</option>
            <optgroup label="SNES">
                <option id="snes" value="smariokart">Super Mario Kart</option>
            </optgroup>
            <optgroup label="N64">
                <option id="n64" value="MK64">Mario Kart 64</option>
                <option id="n64" value="MK4">Mortal Kombat 4</option>
                <option id="n64" value="SM64">Super Mario 64</option>
                <option id="n64" value="D64">Doom 64</option>
                <option id="n64" value="Q2">Quake II</option>
            </optgroup>
            <optgroup label="Nintendo DS">
                <option id="nds" value="MDKDS">Mario vs. Donkey Kong</option>
                <option id="nds" value="MKDS">Mario vs. Donkey Kong 2</option>
                <option id="nds" value="NSMBDS">New Super Mario Bros</option>
                <option id="nds" value="MKDS">Mario Kart DS</option>
                <option id="nds" value="MMZX">Mega-Man ZX</option>
                <option id="nds" value="MMZXA">Mega-Man ZX Advent</option>
                <option id="nds" value="MMZC">Mega-Man Zero Collection</option>
            </optgroup>
            <optgroup label="GBA">
                <option id="GBA" value="PokemonEmerald">Pokemon Emerald</option>
                <option id="GBA" value="PokemonFireRed">Pokemon Fire Red</option>
                <option id="GBA" value="PokemonLeafGreen">Pokemon Leaf Green</option>
                <option id="GBA" value="PokemonRuby">Pokemon Ruby</option>
                <option id="GBA" value="PokemonSapphire">Pokemon Sapphire</option>
                <option id="GBA" value="MKSC">Mario Kart Super Circuit</option>
                <option id="GBA" value="MK5">Mortal Kombat 5: Deadly Alliance</option>
            </optgroup>
            <!-- <optgroup label="Playstation 1">
                <option id="psx" value="GT2">Gran Turismo 2</option>
            </optgroup> -->
        </select>
        <div id=box>
            <input type=file id=input>
            or drag a<br>ROM file here
        </div>
        <button id="Start" onclick="Start();">Start</button>
    </div>
    <script>
        let PackSelect = document.getElementById("Packs");
        let startButton = document.getElementById("Start");

        function updateButtonState() {
            if (PackSelect.value === "Select a game:") {
                startButton.disabled = true;
            } else {
                startButton.disabled = false;
            }
        }
        updateButtonState();
        PackSelect.addEventListener("change", updateButtonState);

        function Start() {
            let Selected = PackSelect.options[PackSelect.selectedIndex].value;
            let core = PackSelect.options[PackSelect.selectedIndex].id;
            let x = document.getElementById("container");
            if (x.style.display === "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
            let gname = Selected;
            let total = `./Roms/${gname}.zip`;
            event.preventDefault();
            const div = document.createElement("div");
            const sub = document.createElement("div");
            const script = document.createElement("script");
            sub.id = "game";
            div.id = "display";
            div.appendChild(sub);
            document.body.appendChild(div);
            window.EJS_player = "#game";
            window.EJS_biosUrl = "";
            window.EJS_gameUrl = total;
            if (core === "GBA") {
                window.location.href = `https://adam-s-amir.github.io/GBA/launcher.html#${gname}`;
            } else {
                window.EJS_core = core;
            }
            window.EJS_pathtodata = "./JS/";
            window.EJS_startOnLoaded = true;
            script.src = "./JS/loader.js";
            document.body.appendChild(script);
        }
        input.onchange = async () => {
            const url = URL.createObjectURL(new Blob([input.files[0]]))
            const parts = input.files[0].name.split(".")
            var extension = parts[parts.length - 1].toLowerCase();
            let core;
            if (extension === 'fds' || extension === 'unif' || extension === 'unf') {
                core = 'nes';
            } else if (extension === 'smc' || extension === 'fig' || extension === 'sfc' || extension === 'gd3' || extension === 'gd7' || extension === 'dx2' || extension === 'swc') {
                core = 'snes';
            } else if (extension === 'z64') {
                core = 'n64';
            } else if (extension === 'gbc') {
                core = 'gb';
            } else if (extension === 'zip' || extension === '7z' || extension === 'rar' || extension === 'iso' || extension === 'tar') {
                alert("Please unzip the file first :)");
                return;
            } else {
                extension = core;
            }

            console.log(core);

            const div = document.createElement("div")
            const sub = document.createElement("div")
            const script = document.createElement("script")

            sub.id = "game"
            div.id = "display"

            div.appendChild(sub)
            document.body.appendChild(div)

            window.EJS_player = "#game"
            window.EJS_biosUrl = ""
            window.EJS_gameUrl = url
            window.EJS_core = core
            window.EJS_pathtodata = "./JS/"
            window.EJS_startOnLoaded = true

            script.src = "./JS/loader.js"
            document.body.appendChild(script)

            box.ondragover = () => box.setAttribute("drag", true)
            box.ondragleave = () => box.removeAttribute("drag")
            let x = document.getElementById("container");
            if (x.style.display === "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
        }
    </script>
    <script src="./JS/jquery.min.js"></script>

</body>

</html>